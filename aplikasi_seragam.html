<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8">
  <title>Aplikasi Seragam - Koperasi Sigap Nusantara</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- ==== ADMIN GUARD (HARUS adminksn) — diletakkan paling atas agar hard-block ==== -->
  <script>
    (function () {
      try {
        var u = (sessionStorage.getItem('username') || '').toLowerCase();
        if (u !== 'adminksn') {
          var html = '<!DOCTYPE html><html lang="id"><head>' +
            '<meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">' +
            '<title>Akses Ditolak</title>' +
            '<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">' +
            '<style>' +
              'body{font-family:Poppins,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;background:#fffef0;min-height:100vh;margin:0;display:flex;align-items:center;justify-content:center;color:#2C3E50}' +
              '.card{max-width:520px;background:#fff;border:1px solid rgba(212,175,55,.25);box-shadow:0 20px 50px rgba(0,0,0,.06);border-radius:16px;padding:28px;text-align:center}' +
              '.badge{display:inline-block;padding:.35rem .6rem;border-radius:9999px;background:#fff3cd;color:#92400e;border:1px solid #facc15;font-weight:600;margin-bottom:8px}' +
              'h1{margin:.2rem 0 .6rem;font-size:1.35rem}' +
              'a.btn{display:inline-block;margin-top:14px;padding:10px 16px;border-radius:12px;background:#d4af37;color:#fff;text-decoration:none}a.btn:hover{filter:brightness(0.95)}' +
            '</style></head><body>' +
            '<div class="card"><div class="badge">Akses dibatasi</div>' +
            '<h1>Halaman ini khusus admin</h1>' +
            '<p>Anda belum login sebagai <b>adminksn</b>.</p>' +
            '<p>Silakan kembali ke halaman utama dan masuk dengan akun admin.</p>' +
            '<a class="btn" href="index.html" rel="noopener">Kembali ke Menu Utama</a>' +
            '</div></body></html>';
          document.open(); document.write(html); document.close();
        }
      } catch (e) {
        document.open(); document.write('<!DOCTYPE html><meta charset="UTF-8"><title>Akses Ditolak</title><p>Session tidak tersedia. Silakan login melalui halaman utama.</p><a href="index.html">Kembali</a>'); document.close();
      }
    })();
  </script>
  <!-- ==== END ADMIN GUARD ==== -->

  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://unpkg.com/aos@2.3.1/dist/aos.css" rel="stylesheet">
  <script src="https://unpkg.com/aos@2.3.1/dist/aos.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <!-- Select2 (opsional) -->
  <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet"/>

  <!-- Export: XLSX & jsPDF (WAJIB UNTUK DOWNLOAD) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.8.2/jspdf.plugin.autotable.min.js"></script>

  <script>
    tailwind.config = {
      theme: {
        extend: {
          fontFamily: { 'poppins': ['Poppins', 'sans-serif'] },
          colors: {
            gold: { 50:'#fffef0',100:'#fef9e7',200:'#f9e79f',300:'#f4d03f',400:'#f1c40f',500:'#d4af37',600:'#b8941f',700:'#917712',800:'#745c0a',900:'#5a4608' },
            primary:'#d4af37', 'primary-dark':'#b8941f', 'primary-light':'#f9e79f', accent:'#f4d03f',
            'koperasi-primary':'#2C3E50','koperasi-secondary':'#d4af37','white':'#ffffff',
            gray:{50:'#f9fafb',100:'#f3f4f6',200:'#e5e7eb',300:'#d1d5db',400:'#9ca3af',500:'#6b7280',600:'#4b5563',700:'#374151',800:'#1f2937',900:'#111827'}
          },
          boxShadow:{ light:'0 4px 12px rgba(212,175,55,0.1)', 'inner-light':'inset 0 1px 3px rgba(0,0,0,0.1)' },
          animation:{ 'float-slow':'float 4s ease-in-out infinite', 'pulse-slow':'pulse 3s cubic-bezier(0.4,0,0.6,1) infinite' }
        }
      }
    }
  </script>

  <style>
    body{font-family:'Poppins',sans-serif;background:linear-gradient(135deg,#ffffff 0%,#fffef0 100%);min-height:100vh;position:relative;color:#2C3E50}
    body::before{content:'';position:fixed;inset:0;background:
      radial-gradient(circle at 20% 80%, rgba(212,175,55,.08) 0%, transparent 50%),
      radial-gradient(circle at 80% 20%, rgba(244,208,63,.1) 0%, transparent 50%);z-index:-1}
    .glass-card{background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border:1px solid rgba(212,175,55,.2);border-radius:1rem;box-shadow:0 4px 30px rgba(0,0,0,.08)}
    .btn-animated{position:relative;overflow:hidden;transition:all .3s cubic-bezier(.4,0,.2,1);transform:translateY(0);background:linear-gradient(135deg,#d4af37,#b8941f);color:#fff}
    .btn-animated::before{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,.3),transparent);transition:.6s}
    .btn-animated:hover::before{left:100%}
    .btn-animated:hover{transform:translateY(-3px);box-shadow:0 10px 25px rgba(212,175,55,.2)}
    .selection-card{transition:all .3s cubic-bezier(.4,0,.2,1);cursor:pointer;background:rgba(255,255,255,.95);backdrop-filter:blur(20px);border:1px solid rgba(212,175,55,.2);border-radius:1rem;box-shadow:0 4px 15px rgba(212,175,55,.1)}
    .selection-card:hover{transform:translateY(-10px);box-shadow:0 20px 40px rgba(212,175,55,.2);border-color:rgba(212,175,55,.4)}
    .selection-card .icon-container{background:linear-gradient(135deg,#d4af37,#b8941f);transition:all .3s ease}
    .selection-card:hover .icon-container{background:linear-gradient(135deg,#b8941f,#917712);transform:scale(1.1) rotate(-5deg)}
    .notification-show{transform:translateY(0)!important;opacity:1!important}
    .animate-spin{animation:spin 1s linear infinite}
    @keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}
    .loading-overlay{background:rgba(0,0,0,.6);backdrop-filter:blur(4px)}
    .loading-content{background:rgba(255,255,255,.95);backdrop-filter:blur(20px)}
    .form-input{transition:all .3s ease;border:2px solid #E5E7EB;background:#fff;box-shadow:0 1px 3px rgba(0,0,0,.1);border-radius:12px;padding:.75rem 1rem}
    .form-input:focus{border-color:#d4af37;box-shadow:0 0 0 3px rgba(212,175,55,.1);outline:none;transform:translateY(-1px)}
    .btn-gradient{background:linear-gradient(135deg,#d4af37,#b8941f);color:#fff;border:none;transition:all .3s ease;box-shadow:0 4px 12px rgba(212,175,55,.2)}
    .btn-gradient:hover{background:linear-gradient(135deg,#b8941f,#917712);transform:translateY(-2px);box-shadow:0 8px 20px rgba(212,175,55,.3)}
    .btn-back{background:linear-gradient(135deg,#6b7280,#4b5563);color:#fff;border:none;transition:all .3s ease;box-shadow:0 4px 12px rgba(107,114,128,.2)}
    .btn-back:hover{background:linear-gradient(135deg,#4b5563,#374151);transform:translateY(-2px);box-shadow:0 8px 20px rgba(107,114,128,.3)}
    .bg-koperasi-primary{background-color:#2C3E50}
    .bg-koperasi-secondary{background-color:#d4af37}
    .text-koperasi-primary{color:#2C3E50}
    .text-koperasi-secondary{color:#d4af37}
    @media print{body *{visibility:hidden}#outputSection,#outputSection *{visibility:visible}#outputSection{position:absolute;top:0;left:0;width:100%;background:#fff;padding:0;margin:0}}
    @media (max-width:768px){
      .container{padding-left:1rem;padding-right:1rem}
      .selection-card{padding:1.5rem}
      .selection-card h3{font-size:1.125rem}
      .glass-card{margin:1rem;padding:1.5rem}
    }
    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:#f1f1f1;border-radius:10px}
    ::-webkit-scrollbar-thumb{background:#d4af37;border-radius:10px}
    ::-webkit-scrollbar-thumb:hover{background:#b8941f}
    .animate-float{animation:float 3s ease-in-out infinite}
    @keyframes float{0%{transform:translateY(0)}50%{transform:translateY(-10px)}100%{transform:translateY(0)}}
    .section-hidden{display:none}
  </style>
</head>
<body class="font-poppins">
  <!-- Loading Spinner -->
  <div id="loadingSpinner" class="fixed inset-0 loading-overlay flex items-center justify-center z-50 hidden">
    <div class="loading-content p-8 rounded-2xl shadow-2xl text-center max-w-sm mx-4">
      <div class="animate-spin rounded-full h-16 w-16 border-t-4 border-b-4 border-koperasi-secondary mx-auto mb-4"></div>
      <p class="text-lg font-semibold text-gray-800">Memproses...</p>
      <p class="text-sm text-gray-600 mt-2">Harap tunggu sebentar</p>
    </div>
  </div>

  <!-- Notification -->
  <div id="notification" class="fixed bottom-4 right-4 px-6 py-4 rounded-xl shadow-lg transform translate-y-16 transition-all duration-300 z-50 hidden max-w-sm opacity-0">
    <div class="flex items-center">
      <i id="notificationIcon" class="fas fa-check-circle mr-3 text-lg"></i>
      <span id="notificationText" class="font-medium">Pesan notifikasi</span>
    </div>
  </div>

  <!-- Seragam Application Screen -->
  <div id="seragamApplication" class="container mx-auto max-w-6xl py-8 px-4 min-h-screen">
    <div class="flex items-center justify-between mb-8 flex-wrap gap-4">
      <div class="flex items-center">
        <button onclick="goBack()" class="mr-4 text-koperasi-secondary hover:text-koperasi-primary p-2 hover:bg-gray-100 rounded-full transition" aria-label="Kembali">
          <i class="fas fa-arrow-left text-2xl" aria-hidden="true"></i>
        </button>
        <h2 class="text-2xl md:text-3xl font-bold text-gray-800 flex items-center">
          <i class="fas fa-tshirt text-koperasi-secondary text-2xl mr-3" aria-hidden="true"></i>
          Aplikasi Seragam Karyawan
        </h2>
      </div>
      <div class="flex gap-3">
        <button onclick="goBack()" class="btn-animated px-6 py-3 rounded-xl font-medium">
          <i class="fas fa-arrow-left mr-2"></i> Kembali
        </button>
        <a href="index.html" class="btn-animated px-6 py-3 rounded-xl font-medium" rel="noopener">
          <i class="fas fa-home mr-2"></i> Menu Utama
        </a>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 max-w-5xl mx-auto" id="menuSection">
      <button onclick="navigateTo('box-search')" class="selection-card p-6 cursor-pointer">
        <div class="icon-container w-16 h-16 rounded-full flex items-center justify-center mb-4">
          <i class="fas fa-search text-white text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">Cari Data PO</h3>
        <p class="text-gray-600">Mencari dan melihat data PO seragam</p>
      </button>

      <button onclick="navigateTo('box-seragam')" class="selection-card p-6 cursor-pointer">
        <div class="icon-container w-16 h-16 rounded-full flex items-center justify-center mb-4">
          <i class="fas fa-file-invoice text-white text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">Input Data Seragam</h3>
        <p class="text-gray-600">Menambahkan data seragam karyawan</p>
      </button>

      <button onclick="navigateTo('box-po')" class="selection-card p-6 cursor-pointer">
        <div class="icon-container w-16 h-16 rounded-full flex items-center justify-center mb-4">
          <i class="fas fa-receipt text-white text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">Input PO_Seragam</h3>
        <p class="text-gray-600">Menambahkan data PO seragam</p>
      </button>

      <button onclick="navigateTo('box-surat')" class="selection-card p-6 cursor-pointer">
        <div class="icon-container w-16 h-16 rounded-full flex items-center justify-center mb-4">
          <i class="fas fa-truck text-white text-2xl"></i>
        </div>
        <h3 class="text-xl font-bold text-gray-800 mb-2">Buat Surat Jalan</h3>
        <p class="text-gray-600">Membuat surat jalan pengiriman</p>
      </button>
    </div>
  </div>

  <!-- Seragam Form Container -->
  <div class="container mx-auto max-w-4xl py-8 px-4 min-h-screen" id="formContainer" style="display:none;">
    <!-- Form Cari Data PO -->
    <div class="glass-card rounded-2xl shadow-2xl p-8 mb-10 section-hidden" id="box-search" data-aos="fade-up">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <i class="fas fa-search text-koperasi-secondary text-2xl mr-3"></i>
          <h2 class="text-2xl font-bold text-gray-800">Cari Data PO</h2>
        </div>
        <button onclick="backToSeragamApplication()" class="btn-back px-4 py-2 rounded-xl text-white font-medium">
          <i class="fas fa-arrow-left mr-2"></i> Kembali
        </button>
      </div>

      <!-- Panel kontrol: cari + filter tanggal + unduh -->
      <div class="flex flex-col lg:flex-row lg:items-end gap-3 mb-4">
        <div class="flex-1">
          <label class="block text-sm font-semibold text-gray-700 mb-1">Cari cepat</label>
          <div class="relative mb-3">
            <input id="po-search-input" type="text" placeholder="Ketik (No PO, Invoice, User, dll.)"
              class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            <i class="fas fa-search absolute left-3 top-3.5 text-gray-400"></i>
          </div>

          <div class="grid grid-cols-1 sm:grid-cols-3 gap-2">
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Dari Tanggal</label>
              <input id="po-date-from" type="date"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent form-input">
            </div>
            <div>
              <label class="block text-xs font-medium text-gray-600 mb-1">Sampai Tanggal</label>
              <input id="po-date-to" type="date"
                class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent form-input">
            </div>
            <div class="flex items-end">
              <button id="po-date-clear" type="button"
                class="w-full btn-back px-4 py-2 rounded-xl text-white font-medium">
                <i class="fas fa-broom mr-2"></i> Reset Filter
              </button>
            </div>
          </div>
        </div>

        <div class="flex gap-2">
          <button id="btn-export-excel" class="btn-animated px-4 py-3 rounded-xl font-medium" title="Unduh Excel">
            <i class="fas fa-file-excel mr-2"></i> Excel
          </button>
          <button id="btn-export-pdf" class="btn-animated px-4 py-3 rounded-xl font-medium" title="Unduh PDF">
            <i class="fas fa-file-pdf mr-2"></i> PDF
          </button>
          <button id="btn-reload-po" class="btn-back px-4 py-3 rounded-xl font-medium" title="Muat ulang">
            <i class="fas fa-rotate mr-2"></i> Refresh
          </button>
        </div>
      </div>

      <div id="notif-search" class="text-center font-bold mb-4 p-3 rounded-lg hidden"></div>

      <!-- Tabel hasil -->
      <div class="overflow-x-auto border border-gray-200 rounded-xl">
        <table class="min-w-full" id="po-table">
          <thead class="bg-gray-50">
            <tr>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">No</th>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">Tanggal</th>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">No. Invoice</th>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">No. PO</th>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">Nominal</th>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">DPP</th>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">DPP9</th>
              <th class="text-left text-xs font-semibold text-gray-600 uppercase tracking-wider px-3 py-2">User</th>
            </tr>
          </thead>
          <tbody id="po-tbody" class="bg-white divide-y divide-gray-100"></tbody>
        </table>
      </div>

      <!-- Info & pagination sederhana -->
      <div class="flex items-center justify-between mt-3 text-sm text-gray-600">
        <div>Menampilkan <span id="po-showing">0</span> dari <span id="po-total">0</span> data</div>
        <div class="flex items-center gap-1">
          <button id="po-prev" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50" disabled><i class="fas fa-chevron-left"></i></button>
          <span id="po-pageinfo">Halaman 1/1</span>
          <button id="po-next" class="px-3 py-1 bg-gray-200 hover:bg-gray-300 rounded disabled:opacity-50" disabled><i class="fas fa-chevron-right"></i></button>
        </div>
      </div>
    </div>

    <!-- Form Data Seragam -->
    <div class="glass-card rounded-2xl shadow-2xl p-8 mb-10 section-hidden" id="box-seragam" data-aos="fade-up">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <i class="fas fa-file-invoice text-koperasi-secondary text-2xl mr-3"></i>
          <h2 class="text-2xl font-bold text-gray-800">Form Data Seragam</h2>
        </div>
        <button onclick="backToSeragamApplication()" class="btn-back px-4 py-2 rounded-xl text-white font-medium">
          <i class="fas fa-arrow-left mr-2"></i> Kembali
        </button>
      </div>

      <div id="notif-seragam" class="text-center font-bold mb-6 p-3 rounded-lg"></div>

      <form id="form-seragam" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-gray-700 font-semibold mb-2">Tanggal:</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-calendar-alt text-gray-400"></i>
              </div>
              <input type="date" name="tanggal" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>

          <div>
            <label class="block text-gray-700 font-semibold mb-2">No. Invoice:</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-file-invoice text-gray-400"></i>
              </div>
              <input type="text" name="no_inv" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-gray-700 font-semibold mb-2">No. PO:</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-receipt text-gray-400"></i>
              </div>
              <input type="text" name="no_po" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>

          <div>
            <label class="block text-gray-700 font-semibold mb-2">Nominal:</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-money-bill-wave text-gray-400"></i>
              </div>
              <input type="number" name="nominal" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">User:</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-user text-gray-400"></i>
            </div>
            <input type="text" name="user" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
          </div>
        </div>

        <button type="submit" class="w-full btn-animated btn-gradient text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all duration-300">
          <i class="fas fa-paper-plane mr-2"></i> Kirim Data Seragam
        </button>
      </form>
    </div>

    <!-- Form Data PO_Seragam -->
    <div class="glass-card rounded-2xl shadow-2xl p-8 mb-10 section-hidden" id="box-po" data-aos="fade-up">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <i class="fas fa-receipt text-koperasi-secondary text-2xl mr-3"></i>
          <h2 class="text-2xl font-bold text-gray-800">Form Data PO_Seragam</h2>
        </div>
        <button onclick="backToSeragamApplication()" class="btn-back px-4 py-2 rounded-xl text-white font-medium">
          <i class="fas fa-arrow-left mr-2"></i> Kembali
        </button>
      </div>

      <div id="notif-po" class="text-center font-bold mb-6 p-3 rounded-lg"></div>

      <form id="form-po" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-gray-700 font-semibold mb-2">Tanggal:</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-calendar-alt text-gray-400"></i>
              </div>
              <input type="date" name="tanggal" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>

          <div>
            <label class="block text-gray-700 font-semibold mb-2">No. BK:</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-file-alt text-gray-400"></i>
              </div>
              <input type="text" name="no_bk" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">No. PO:</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-receipt text-gray-400"></i>
            </div>
            <input type="text" name="no_po" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
          </div>
        </div>

        <button type="submit" class="w-full btn-animated btn-gradient text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all duration-300">
          <i class="fas fa-paper-plane mr-2"></i> Kirim Data PO_Seragam
        </button>
      </form>
    </div>

    <!-- Form Surat Jalan -->
    <div class="glass-card rounded-2xl shadow-2xl p-8 mb-10 section-hidden" id="box-surat" data-aos="fade-up">
      <div class="flex items-center justify-between mb-6">
        <div class="flex items-center">
          <i class="fas fa-truck text-koperasi-secondary text-2xl mr-3"></i>
          <h2 class="text-2xl font-bold text-gray-800">Form Input Surat Jalan</h2>
        </div>
        <button onclick="backToSeragamApplication()" class="btn-back px-4 py-2 rounded-xl text-white font-medium">
          <i class="fas fa-arrow-left mr-2"></i> Kembali
        </button>
      </div>

      <form id="suratForm" class="space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
          <div>
            <label class="block text-gray-700 font-semibold mb-2">Nomor Surat</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-hashtag text-gray-400"></i>
              </div>
              <input type="text" name="nomor" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>

          <div>
            <label class="block text-gray-700 font-semibold mb-2">Tanggal</label>
            <div class="relative">
              <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                <i class="fas fa-calendar-alt text-gray-400"></i>
              </div>
              <input type="date" name="tanggal" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
            </div>
          </div>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">User</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-user text-gray-400"></i>
            </div>
            <input type="text" name="user" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
          </div>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">No. PO</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-receipt text-gray-400"></i>
            </div>
            <input type="text" name="no_po" class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
          </div>
        </div>

        <div>
          <label class="block text-gray-700 font-semibold mb-2">Jumlah Barang</label>
          <div class="relative">
            <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
              <i class="fas fa-boxes text-gray-400"></i>
            </div>
            <input type="number" name="jumlahBarang" min="1" required class="w-full pl-10 pr-4 py-3 border border-gray-300 rounded-xl focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent shadow-sm form-input">
          </div>
        </div>

        <button type="button" onclick="buatInputBarang()" class="w-full btn-animated bg-gradient-to-r from-koperasi-secondary to-gold-600 hover:from-gold-600 hover:to-gold-700 text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all duration-300">
          <i class="fas fa-plus-circle mr-2"></i> Buat Form Barang
        </button>

        <div id="barangInputs" class="space-y-6"></div>

        <button type="submit" class="w-full btn-animated btn-gradient text-white font-bold py-3 px-4 rounded-xl shadow-lg transition-all duration-300">
          <i class="fas fa-file-contract mr-2"></i> Tampilkan Surat Jalan
        </button>
      </form>

      <div class="text-center mt-8">
        <button id="printButton" onclick="printSurat()" class="hidden btn-animated bg-gradient-to-r from-gold-600 to-gold-700 hover:from-gold-700 hover:to-gold-800 text-white font-bold py-3 px-6 rounded-xl shadow-lg transition-all duration-300">
          <i class="fas fa-print mr-2"></i> Cetak / Simpan PDF
        </button>
      </div>

      <div id="outputSection" class="mt-10 p-6 bg-gold-50 rounded-xl border border-gold-200 section-hidden">
        <div id="output"></div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div id="toast" class="fixed bottom-4 left-1/2 -translate-x-1/2 hidden px-4 py-2 rounded-lg bg-slate-900 text-white text-sm shadow-lg"></div>

  <script>
    // AOS
    document.addEventListener('DOMContentLoaded', function () {
      AOS.init({ duration: 800, easing: 'ease-out-cubic', once: true, offset: 50 });
    });

    // ======================= KONFIGURASI ENDPOINT =======================
    const scriptURL = "https://script.google.com/macros/s/AKfycbw3GUPPRCG3BALbs1oIfDxTpUZqscqYhN5UzoK1-29Jm1hIjotJSQLoXVT0yKJxdmT7/exec";

    // ===> Bagian PO (ambil semua dulu, lalu cari/filter lokal)
    const LIST_ACTION = "listPO"; // sesuaikan dengan Apps Script Anda bila beda
    const PAGE_SIZE = 10;

    // ======================= TOAST & NOTIF =======================
    const toast = (msg, ok = true) => {
      const t = document.getElementById('toast');
      t.textContent = msg;
      t.className = "fixed bottom-4 left-1/2 -translate-x-1/2 px-4 py-2 rounded-lg text-sm shadow-lg " + (ok ? "bg-gold-500 text-white" : "bg-rose-600 text-white");
      t.style.opacity = 1; t.style.display = 'block';
      setTimeout(() => { t.style.opacity = 0; setTimeout(() => t.style.display = 'none', 300) }, 1800);
    };

    function showNotification(message, isSuccess = true) {
      const notification = $('#notification');
      const icon = $('#notificationIcon');
      const text = $('#notificationText');
      text.text(message);
      if (isSuccess) {
        notification.removeClass('bg-red-500 border-red-400').addClass('bg-green-500 border-green-400');
        icon.removeClass('fa-times-circle fa-exclamation-triangle').addClass('fa-check-circle');
      } else {
        notification.removeClass('bg-green-500 border-green-400').addClass('bg-red-500 border-red-400');
        icon.removeClass('fa-check-circle').addClass('fa-times-circle');
      }
      notification.removeClass('hidden').removeClass('translate-y-16').addClass('notification-show');
      setTimeout(() => {
        notification.addClass('translate-y-16').removeClass('notification-show');
        setTimeout(() => { notification.addClass('hidden'); }, 300);
      }, 5000);
    }

    // ======================= NAV =======================
    function goBack() { window.history.back(); }
    function navigateTo(formId) {
      document.getElementById("seragamApplication").style.display = "none";
      document.getElementById("formContainer").style.display = "block";
      ["box-search","box-seragam","box-po","box-surat"].forEach(id=>{
        const el=document.getElementById(id); if(el) el.classList.add('section-hidden');
      });
      const target=document.getElementById(formId); if(target) target.classList.remove('section-hidden');
      window.scrollTo({ top: 0, behavior: 'smooth' }); AOS.refresh();

      if (formId === 'box-search') {
        loadAllPO();
      }
    }
    function backToSeragamApplication() {
      document.getElementById("formContainer").style.display = "none";
      document.getElementById("seragamApplication").style.display = "block";
      document.getElementById("menuSection").scrollIntoView({ behavior: 'smooth' }); AOS.refresh();
    }

    // ======================= STATE PO =======================
    let PO_ALL = [];        // semua data dari server (sekali ambil)
    let PO_FILTERED = [];   // hasil filter lokal (keyword + tanggal)
    let poPage = 1;

    // ======================= UTIL UMUM =======================
    function rupiah(num) {
      if (num === null || num === undefined || num === '') return '-';
      const n = Number(num); if (isNaN(n)) return String(num);
      return n.toLocaleString('id-ID');
    }

    // --- Util tanggal untuk filter (dukung "YYYY-MM-DD" & "DD/MM/YYYY") ---
    function parseToDateObj(s) {
      if (!s) return null;
      s = String(s).trim();
      if (/^\d{4}-\d{2}-\d{2}$/.test(s)) {
        const [Y, M, D] = s.split('-').map(Number);
        return new Date(Y, M - 1, D);
      }
      if (/^\d{1,2}\/\d{1,2}\/\d{4}$/.test(s)) {
        const [D, M, Y] = s.split('/').map(Number);
        return new Date(Y, (M - 1), D);
      }
      const d = new Date(s);
      return isNaN(d.getTime()) ? null : d;
    }

    function inDateRange(tanggalStr, fromStr, toStr) {
      const dt = parseToDateObj(tanggalStr);
      if (!dt) return false; // bila tanggal data invalid, anggap di luar filter
      const from = parseToDateObj(fromStr);
      const to   = parseToDateObj(toStr);
      if (from && dt < from) return false;
      if (to) {
        // agar inclusive (<= to 23:59:59)
        const toEnd = new Date(to.getFullYear(), to.getMonth(), to.getDate(), 23, 59, 59, 999);
        if (dt > toEnd) return false;
      }
      return true;
    }

    // ======================= LOAD SEMUA PO (ONCE) =======================
    async function loadAllPO() {
      if (PO_ALL.length) { applyPOFilter(); return; }
      const spinner = document.getElementById('loadingSpinner');
      const notif = document.getElementById('notif-search');
      spinner.classList.remove('hidden');
      notif.classList.remove('hidden');
      notif.textContent = "🔄 Memuat semua data PO...";
      notif.className = "text-center font-bold mb-4 p-3 rounded-lg bg-blue-100 text-blue-700";

      try {
        const url = `${scriptURL}?action=${encodeURIComponent(LIST_ACTION)}`;
        const res = await fetch(url, { method: 'GET', cache: 'no-cache' });
        const json = await res.json();
        if (json.status === 'success' && Array.isArray(json.data)) {
          PO_ALL = json.data;
          showNotification(`Berhasil memuat ${PO_ALL.length} data PO.`);
          notif.textContent = `✅ Berhasil memuat ${PO_ALL.length} data PO`;
          notif.className = "text-center font-bold mb-4 p-3 rounded-lg bg-green-100 text-green-700";
          applyPOFilter();
        } else {
          notif.textContent = json.message || "❌ Gagal memuat data.";
          notif.className = "text-center font-bold mb-4 p-3 rounded-lg bg-red-100 text-red-700";
          showNotification("Gagal memuat data PO", false);
        }
      } catch (err) {
        notif.textContent = "❌ Gagal terhubung ke server.";
        notif.className = "text-center font-bold mb-4 p-3 rounded-lg bg-red-100 text-red-700";
        showNotification("Gagal terhubung ke server: " + err.message, false);
      } finally {
        spinner.classList.add('hidden');
        setTimeout(()=>notif.classList.add('hidden'), 1500);
      }
    }

    // ======================= FILTER/SEARCH LOKAL PO =======================
    function applyPOFilter() {
      const q  = (document.getElementById('po-search-input').value || '').toLowerCase().trim();
      const df = (document.getElementById('po-date-from').value || '').trim();
      const dt = (document.getElementById('po-date-to').value || '').trim();

      let base = PO_ALL;
      // Filter keyword
      if (q) {
        base = base.filter(item => {
          const no       = (item.no || '').toString().toLowerCase();
          const tgl      = (item.tanggal || '').toString().toLowerCase();
          const inv      = (item.no_inv || '').toString().toLowerCase();
          const po       = (item.no_po || '').toString().toLowerCase();
          const nominal  = (item.nominal || '').toString().toLowerCase();
          const dpp      = (item.dpp || '').toString().toLowerCase();
          const dpp9     = (item.dpp9 || '').toString().toLowerCase();
          const user     = (item.user || '').toString().toLowerCase();
          return (
            no.includes(q) || tgl.includes(q) || inv.includes(q) || po.includes(q) ||
            nominal.includes(q) || dpp.includes(q) || dpp9.includes(q) || user.includes(q)
          );
        });
      }
      // Filter tanggal (jika salah satu terisi, tetap jalan; bila kosong, lolos semua)
      if (df || dt) {
        base = base.filter(item => inDateRange(item.tanggal, df, dt));
      }

      PO_FILTERED = base;
      poPage = 1;
      renderPOTable();
    }

    // ======================= RENDER TABEL PO =======================
    function renderPOTable() {
      const tbody = document.getElementById('po-tbody');
      tbody.innerHTML = "";
      const total = PO_FILTERED.length;
      const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
      if (poPage > totalPages) poPage = totalPages;

      const start = (poPage - 1) * PAGE_SIZE;
      const pageData = PO_FILTERED.slice(start, start + PAGE_SIZE);

      if (!pageData.length) {
        tbody.innerHTML = `<tr><td colspan="8" class="px-4 py-4 text-center text-gray-500">Tidak ada data</td></tr>`;
      } else {
        pageData.forEach((item, idx) => {
          const rowIdx = start + idx + 1;
          const tr = document.createElement('tr');
          tr.innerHTML = `
            <td class="px-3 py-2 text-sm text-gray-800">${item.no ?? rowIdx}</td>
            <td class="px-3 py-2 text-sm text-gray-800">${item.tanggal || '-'}</td>
            <td class="px-3 py-2 text-sm text-gray-800">${item.no_inv || '-'}</td>
            <td class="px-3 py-2 text-sm text-gray-800">${item.no_po || '-'}</td>
            <td class="px-3 py-2 text-sm text-gray-800">${rupiah(item.nominal)}</td>
            <td class="px-3 py-2 text-sm text-gray-800">${rupiah(item.dpp)}</td>
            <td class="px-3 py-2 text-sm text-gray-800">${rupiah(item.dpp9)}</td>
            <td class="px-3 py-2 text-sm text-gray-800">${item.user || '-'}</td>
          `;
          tbody.appendChild(tr);
        });
      }

      // footer info
      document.getElementById('po-showing').textContent = pageData.length;
      document.getElementById('po-total').textContent = total;
      document.getElementById('po-pageinfo').textContent = `Halaman ${poPage}/${totalPages}`;
      document.getElementById('po-prev').disabled = (poPage <= 1);
      document.getElementById('po-next').disabled = (poPage >= totalPages);
    }

    // ======================= EKSPOR (WEB & WEBVIEW/WEB2APK) =======================
    // Deteksi Android WebView (umum untuk pembungkus Web2APK)
    function isAndroidWebView() {
      const ua = navigator.userAgent || "";
      return /Android/i.test(ua) && /wv|Version\/\d+\.\d+.*Chrome\/\d+.*Mobile Safari/i.test(ua);
    }

    // Unduh aman: hindari blob: di WebView → ubah ke data:URL (base64) via FileReader
    async function downloadBlobSafe(filename, blob) {
      if (!isAndroidWebView()) {
        try {
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
          setTimeout(() => URL.revokeObjectURL(url), 1200);
          return;
        } catch (_) { /* fallback to data URL */ }
      }
      try {
        const dataUrl = await new Promise((resolve, reject) => {
          const r = new FileReader();
          r.onloadend = () => resolve(r.result);
          r.onerror = reject;
          r.readAsDataURL(blob);
        });
        const a = document.createElement('a');
        if ('download' in a) {
          a.href = dataUrl;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          a.remove();
        } else {
          window.location.href = dataUrl;
        }
      } catch (err) {
        console.error('Gagal membuat data URL:', err);
        alert('Tidak bisa menyimpan file. Pastikan izin penyimpanan aplikasi aktif.');
      }
    }

    // Excel
    async function exportPOToExcel() {
      if (!PO_FILTERED.length) return toast('Tidak ada data untuk diekspor', false);
      const data = PO_FILTERED.map(x => ({
        'No'       : x.no ?? '',
        'Tanggal'  : x.tanggal ?? '',
        'No. Invoice': x.no_inv ?? '',
        'No. PO'   : x.no_po ?? '',
        'Nominal'  : x.nominal ?? '',
        'DPP'      : x.dpp ?? '',
        'DPP9'     : x.dpp9 ?? '',
        'User'     : x.user ?? ''
      }));
      const wb = XLSX.utils.book_new();
      const ws = XLSX.utils.json_to_sheet(data);
      XLSX.utils.book_append_sheet(wb, ws, 'PO_Seragam');
      const d = new Date();
      const ds = `${String(d.getFullYear())}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
      const filename = `PO_Seragam_${ds}.xlsx`;

      try {
        XLSX.writeFile(wb, filename); // browser normal
        toast('Berhasil ekspor Excel');
      } catch (err) {
        try {
          const wbout = XLSX.write(wb, { bookType: 'xlsx', type: 'array' });
          const blob = new Blob([wbout], {
            type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
          });
          await downloadBlobSafe(filename, blob);
          toast('Berhasil ekspor Excel');
        } catch (e2) {
          console.error(e2);
          toast('Gagal ekspor Excel: ' + e2.message, false);
        }
      }
    }

    // PDF
    async function exportPOToPDF() {
      if (!PO_FILTERED.length) return toast('Tidak ada data untuk diekspor', false);
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF({ orientation: 'landscape' });

      doc.setFontSize(14);
      doc.text('Daftar PO Seragam', 148, 14, { align: 'center' });

      const body = PO_FILTERED.map((x, i) => ([
        x.no ?? (i+1), x.tanggal ?? '', x.no_inv ?? '', x.no_po ?? '',
        rupiah(x.nominal), rupiah(x.dpp), rupiah(x.dpp9), x.user ?? ''
      ]));

      doc.autoTable({
        startY: 20,
        head: [['No', 'Tanggal', 'No. Invoice', 'No. PO', 'Nominal', 'DPP', 'DPP9', 'User']],
        body,
        styles: { fontSize: 8, cellPadding: 3 },
        headStyles: { fillColor: [212,175,55], textColor: 255 }
      });

      const d = new Date();
      const ds = `${String(d.getFullYear())}${String(d.getMonth()+1).padStart(2,'0')}${String(d.getDate()).padStart(2,'0')}`;
      const filename = `PO_Seragam_${ds}.pdf`;

      try {
        doc.save(filename); // browser normal
        toast('Berhasil ekspor PDF');
      } catch (err) {
        try {
          const pdfBlob = doc.output('blob');
          await downloadBlobSafe(filename, pdfBlob);
          toast('Berhasil ekspor PDF');
        } catch (e2) {
          console.error(e2);
          toast('Gagal ekspor PDF: ' + e2.message, false);
        }
      }
    }

    // ======================= EVENT WIRING PO =======================
    document.getElementById('po-search-input').addEventListener('input', applyPOFilter);
    document.getElementById('po-date-from').addEventListener('change', applyPOFilter);
    document.getElementById('po-date-to').addEventListener('change', applyPOFilter);
    document.getElementById('po-date-clear').addEventListener('click', () => {
      document.getElementById('po-date-from').value = '';
      document.getElementById('po-date-to').value = '';
      applyPOFilter();
    });

    document.getElementById('po-prev').addEventListener('click', () => { if (poPage>1){ poPage--; renderPOTable(); }});
    document.getElementById('po-next').addEventListener('click', () => { poPage++; renderPOTable(); });
    document.getElementById('btn-export-excel').addEventListener('click', () => { exportPOToExcel(); });
    document.getElementById('btn-export-pdf').addEventListener('click', () => { exportPOToPDF(); });
    document.getElementById('btn-reload-po').addEventListener('click', () => { PO_ALL = []; loadAllPO(); });

    // ======================= SUBMIT HANDLERS =======================
    document.getElementById('form-seragam').addEventListener('submit', async function (e) {
      e.preventDefault();
      const notif = document.getElementById('notif-seragam');
      const formData = new FormData(e.target);
      document.getElementById('loadingSpinner').classList.remove('hidden');
      try {
        await fetch(scriptURL, { method: "POST", body: formData });
        notif.textContent = "✅ Data Seragam berhasil dikirim!";
        notif.className = "text-center font-bold mb-6 p-3 rounded-lg bg-green-100 text-green-700";
        e.target.reset();
        showNotification("Data Seragam berhasil dikirim!"); toast("Data Seragam berhasil dikirim!");
      } catch (err) {
        notif.textContent = "❌ Gagal mengirim data.";
        notif.className = "text-center font-bold mb-6 p-3 rounded-lg bg-red-100 text-red-700";
        showNotification("Gagal mengirim data: " + err.message, false); toast("Gagal mengirim data: " + err.message, false);
      } finally {
        document.getElementById('loadingSpinner').classList.add('hidden');
      }
    });

    document.getElementById('form-po').addEventListener('submit', async function (e) {
      e.preventDefault();
      const notif = document.getElementById('notif-po');
      const formData = new FormData(e.target);
      document.getElementById('loadingSpinner').classList.remove('hidden');
      try {
        await fetch(scriptURL, { method: "POST", body: formData });
        notif.textContent = "✅ Data PO_Seragam berhasil dikirim!";
        notif.className = "text-center font-bold mb-6 p-3 rounded-lg bg-green-100 text-green-700";
        e.target.reset();
        showNotification("Data PO_Seragam berhasil dikirim!"); toast("Data PO_Seragam berhasil dikirim!");
      } catch (err) {
        notif.textContent = "❌ Gagal mengirim data.";
        notif.className = "text-center font-bold mb-6 p-3 rounded-lg bg-red-100 text-red-700";
        showNotification("Gagal mengirim data: " + err.message, false); toast("Gagal mengirim data: " + err.message, false);
      } finally {
        document.getElementById('loadingSpinner').classList.add('hidden');
      }
    });

    // ======================= SURAT JALAN =======================
    function buatInputBarang() {
      const jumlah = document.querySelector('input[name="jumlahBarang"]').value;
      const container = document.getElementById('barangInputs');
      container.innerHTML = "";
      for (let i = 1; i <= jumlah; i++) {
        container.innerHTML +=
          `<div class="bg-gold-50 p-5 rounded-xl border border-gold-200">
            <h3 class="font-bold text-gold-700 mb-3 flex items-center">
              <i class="fas fa-box mr-2"></i> Barang ${i}
            </h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
              <div class="md:col-span-2">
                <label class="block text-sm font-medium text-gray-700 mb-1">Nama Barang ${i}</label>
                <input type="text" name="barang${i}" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent form-input">
              </div>
              <div>
                <label class="block text-sm font-medium text-gray-700 mb-1">Qty ${i}</label>
                <input type="number" name="qty${i}" required class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent form-input">
              </div>
            </div>
            <div class="mt-3">
              <label class="block text-sm font-medium text-gray-700 mb-1">Satuan ${i}</label>
              <select name="satuan${i}" class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-koperasi-secondary focus:border-transparent form-input">
                <option value="pcs">pcs</option>
                <option value="stel">stel</option>
                <option value="psg">psg</option>
              </select>
            </div>
          </div>`;
      }
    }

    function openPrintWindow(suratData) {
      const w = window.open('', '_blank');
      const d = w.document;
      d.write(`<!DOCTYPE html>
<html lang="id"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Surat Jalan</title>
<style>
  body{font-family:Arial,sans-serif;margin:20px}
  .container{display:flex;justify-content:space-between;align-items:flex-start}
  .header,.header-koperasi{font-weight:bold}
  .center{text-align:center}
  .right{text-align:right}
  .signature{text-align:center;margin-top:20px}
  .section-gap{margin-bottom:10px}
  .item-gap{margin-top:10px}
  .koperasi,.surat-jalan{width:48%;padding:10px}
  .surat-jalan{border:1px solid #000}
  table{width:100%;border-collapse:collapse;margin-top:20px}
  th,td{border:1px solid #000;padding:8px;text-align:left}
  th{background:#f2f2f2}
  .signature-block td{height:100px;vertical-align:bottom;text-align:center}
</style></head>
<body>
  <div class="container section-gap">
    <div class="koperasi">
      <div class="header-koperasi">Koperasi Sigap Nusantara</div>
      <div>Jl. A. Yani No. 66, RW. 3, Cemp. Putih Timur</div>
      <div>Kota Jakarta Pusat - 10510</div>
      <div>(021) 21242525<br>NPWP: 02.250.480.7-408.000</div>
    </div>
    <div class="surat-jalan">
      <p class="header center">Surat Jalan</p>
      <p style="display:flex;justify-content:space-between;margin:5px 0;"><span style="width:70px;">Nomor</span><span>:</span><span style="flex:1;margin-left:10px;">${suratData.nomor}/SRT/SPA/VIII/2025</span></p>
      <p style="display:flex;justify-content:space-between;margin:5px 0;"><span style="width:70px;">Tanggal</span><span>:</span><span style="flex:1;margin-left:10px;">${suratData.tanggal}</span></p>
      <p style="display:flex;justify-content:space-between;margin:5px 0;"><span style="width:70px;">User</span><span>:</span><span style="flex:1;margin-left:10px;">${suratData.user}</span></p>
      <p style="display:flex;justify-content:space-between;margin:5px 0;"><span style="width:70px;">No PO</span><span>:</span><span style="flex:1;margin-left:10px;">${suratData.no_po || ''}</span></p>
      <p style="display:flex;justify-content:space-between;margin:5px 0;"><span style="width:70px;">Penerima</span><span>:</span><span style="flex:1;margin-left:10px;"></span></p>
    </div>
  </div>
  <table style="width:30%;border-collapse:collapse;border:1px solid #000;margin-top:20px;">
    <tr><td colspan="4" class="center" style="border:1px solid #000;padding:5px;font-style:italic">Alamat Pengiriman</td></tr>
    <tr><td colspan="4" style="font-weight:bold;border:1px solid #000;padding:5px;">PT. Sigap Prima Astrea</td></tr>
    <tr><td colspan="4" style="border:1px solid #000;padding:5px;">Jl. A. Yani No. 66, RW. 3,<br>Cemp. Putih Tim., Kec. Cemp. Putih,</td></tr>
    <tr><td colspan="4" style="border:1px solid #000;padding:5px;">Kota Jakarta Pusat - 10510</td></tr>
  </table>
  <table>
    <tr><td colspan="5" style="border:1px solid #000;padding:5px;">Harap dikirimkan barang-barang berikut ini:</td></tr>
    <tr>
      <th>No.</th><th colspan="2">Nama Barang</th><th>Qty</th><th>Satuan</th>
    </tr>
    ${suratData.rows}
    <tr>
      <td colspan="2" style="border:1px solid #000;padding:5px;text-align:center;font-weight:bold;">Disiapkan oleh</td>
      <td style="border:1px solid #000;padding:5px;text-align:center;font-weight:bold;">Disetujui oleh</td>
      <td></td>
      <td style="border:1px solid #000;padding:5px;text-align:center;font-weight:bold;">Dikonfirmasi oleh</td>
    </tr>
    <tr style="font-weight:bold;">
      <td colspan="2" class="signature" style="border:1px solid #000;padding:5px;text-align:center;"><br><br><br><br><br>Steven Jefferson<br><span style="font-size:smaller;">Staff Koperasi</span></td>
      <td class="signature" style="border:1px solid #000;padding:5px;text-align:center;"><br><br><br><br><br>Agus Sofyan Effendi<br><span style="font-size:smaller;">Manager Koperasi</span></td>
      <td></td>
      <td class="signature" style="border:1px solid #000;padding:5px;text-align:center;"><br><br><br><br><br>Customer</td>
    </tr>
  </table>
  <script>window.onload=function(){setTimeout(function(){window.print()},500)}<\/script>
</body></html>`);
      d.close();
    }

    function printSurat() {
      const form = document.querySelector('#box-surat form');
      if (!form) { alert("Form Surat Jalan tidak ditemukan!"); return; }
      const nomor = form.nomor.value;
      const tanggalInput = form.tanggal.value;
      const user = form.user.value;
      let noPoInput = form.querySelector('input[name="no_po"]');
      if (!noPoInput) { noPoInput = document.createElement('input'); noPoInput.type = 'hidden'; noPoInput.name = 'no_po'; form.appendChild(noPoInput); }
      const no_po = noPoInput.value;
      const jumlah = parseInt(form.jumlahBarang.value);
      if (!nomor || !tanggalInput || !user || isNaN(jumlah) || jumlah <= 0) { alert("Harap isi semua field yang diperlukan dan buat form barang terlebih dahulu."); return; }

      // === Format ke DD/MM/YYYY ===
      let tanggalFormatted = "";
      if (tanggalInput) {
        const d = new Date(tanggalInput);
        const dd = String(d.getDate()).padStart(2, '0');
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const yyyy = d.getFullYear();
        tanggalFormatted = `${dd}/${mm}/${yyyy}`;
      }

      let rows = "";
      for (let i = 1; i <= jumlah; i++) {
        const namaInput = form[`barang${i}`];
        const qtyInput = form[`qty${i}`];
        const satuanInput = form[`satuan${i}`];
        if (namaInput && qtyInput && satuanInput) {
          rows += `<tr><td style="border:1px solid #000;padding:5px;">${i}</td><td colspan="2" style="border:1px solid #000;padding:5px;">${namaInput.value}</td><td style="border:1px solid #000;padding:5px;">${qtyInput.value}</td><td style="border:1px solid #000;padding:5px;">${satuanInput.value}</td></tr>`;
        }
      }
      openPrintWindow({ nomor, tanggal: tanggalFormatted, user, no_po, rows });
    }

    document.getElementById("suratForm").addEventListener("submit", function (e) {
      e.preventDefault();
      const form = e.target;
      const nomor = form.nomor.value;
      const tanggalInput = form.tanggal.value;
      const user = form.user.value;
      let noPoInput = form.querySelector('input[name="no_po"]');
      if (!noPoInput) { noPoInput = document.createElement('input'); noPoInput.type = 'hidden'; noPoInput.name = 'no_po'; form.appendChild(noPoInput); }
      const no_po = noPoInput.value;
      const jumlah = parseInt(form.jumlahBarang.value);

      // === Format ke DD/MM/YYYY untuk PREVIEW ===
      let tanggalFormatted = "";
      if (tanggalInput) {
        const d = new Date(tanggalInput);
        const dd = String(d.getDate()).padStart(2, '0');
        const mm = String(d.getMonth() + 1).padStart(2, '0');
        const yyyy = d.getFullYear();
        tanggalFormatted = `${dd}/${mm}/${yyyy}`;
      }

      let rows = "";
      for (let i = 1; i <= jumlah; i++) {
        const nama = form[`barang${i}`].value;
        const qty = form[`qty${i}`].value;
        const satuan = form[`satuan${i}`].value;
        rows += `<tr><td class="border border-gray-400 p-2">${i}</td><td class="border border-gray-400 p-2">${nama}</td><td class="border border-gray-400 p-2">${qty}</td><td class="border border-gray-400 p-2">${satuan}</td></tr>`;
      }
      document.getElementById("output").innerHTML =
        `<div class="bg-white p-6 rounded-xl shadow-lg">
          <table class="w-full border-collapse border border-gray-400">
            <tr>
              <td colspan="2" class="border border-gray-400 p-4 align-top">
                <strong class="text-lg text-koperasi-secondary">Koperasi Sigap Nusantara</strong><br>
                <div class="mt-2 text-gray-700">
                  Jl. A. Yani No.66, RW.3, Cemp. Putih Timur<br>
                  Kota Jakarta Pusat - 10510<br>
                  (021) 2124525<br>
                  NPWP: 02.250.480.7-408.000
                </div>
              </td>
              <td colspan="2" class="border border-gray-400 p-4 text-right align-top">
                <strong class="text-lg text-koperasi-secondary">Surat Jalan</strong><br><br>
                <div class="text-gray-700">
                  Nomor: ${nomor}<br>
                  Tanggal: ${tanggalFormatted}<br>
                  User: ${user}<br>
                  No PO: ${no_po || '-'}
                </div>
              </td>
            </tr>
            <tr>
              <td colspan="4" class="border border-gray-400 p-4 bg-gold-50">
                <strong class="text-koperasi-secondary">Alamat Pengiriman</strong><br>
                <div class="mt-2 text-gray-700">
                  PT. Sigap Prima Astrea<br>
                  Jl. A. Yani No.66, RW.3, Cemp. Putih Tim., Kec. Cemp. Putih,<br>
                  Kota Jakarta Pusat - 10510
                </div>
              </td>
            </tr>
            <tr><td colspan="4" class="border border-gray-400 p-4">Harap dikirimkan barang-barang berikut ini:</td></tr>
            <tr>
              <th class="border border-gray-400 p-2 bg-gray-100">No.</th>
              <th class="border border-gray-400 p-2 bg-gray-100">Nama Barang</th>
              <th class="border border-gray-400 p-2 bg-gray-100">Qty</th>
              <th class="border border-gray-400 p-2 bg-gray-100">Satuan</th>
            </tr>
            ${rows}
            <tr class="signature-block">
              <td class="border border-gray-400 p-4 h-32 align-bottom text-center">
                <div class="text-gray-700">Disiapkan oleh</div><br><br>
                <strong class="text-koperasi-secondary">Steven Jefferson</strong><br>
                <span class="text-sm text-gray-600">Staff Koperasi</span>
              </td>
              <td class="border border-gray-400 p-4 h-32 align-bottom text-center">
                <div class="text-gray-700">Disetujui oleh</div><br><br>
                <strong class="text-koperasi-secondary">Agus Sofyan Effendi</strong><br>
                <span class="text-sm text-gray-600">Manager Koperasi</span>
              </td>
              <td colspan="2" class="border border-gray-400 p-4 h-32 align-bottom text-center">
                <div class="text-gray-700">Dikonfirmasi oleh</div><br><br>
                <strong class="text-gray-700">________________________</strong><br>
                <span class="text-sm text-gray-600">Customer</span>
              </td>
            </tr>
          </table>
        </div>`;
      document.getElementById("outputSection").classList.remove('section-hidden');
      document.getElementById("printButton").classList.remove('hidden');
      document.getElementById("outputSection").scrollIntoView({ behavior: 'smooth' });
    });
  </script>
</body>
</html>
